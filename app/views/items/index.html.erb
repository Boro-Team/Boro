<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->
<script src='//cdn.rawgit.com/googlemaps/js-rich-marker/gh-pages/src/richmarker-compiled.js' type='text/javascript'></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>


<%= form_tag("/items", method: "get") do %>
  <%= label_tag(:location, "Find items in:") %>
	<input id="geo" type="text" placeholder="Type in an address" size="90" />
  <%= hidden_field_tag(:formatted_address) %>
  <%= label_tag(:range, "Within how many km:") %>
  <%= text_field_tag(:range) %>
  <%= submit_tag("Search") %>
<% end %>

<div style='width: 800px;'>
  <div id="search_map" style='width: 800px; height: 500px;'></div>
</div>

<br>
<br>
<table>
	<tr>
		<th>Title</th>
		<th>Category</th>
		<th>Description</th>
		<th>Price/Day</th>
		<th>Edit</th>
		<th>Delete</th>
	</tr>
		<% @item.each do |i| %>
	<tr>
		<td><%= link_to "#{i.title}", item_path(i.id) %></td>
		<td><%= link_to "#{i.tag_list.first}", tags_path(i.tag_list.first) %></td>
		<td style="text-align: center;"><%= link_to "#{i.description}", item_path(i.id)%></td>
		<td style="text-align: center;"><%= i.price_per_day %></td>
			<% if current_user.id == i.user_id %>
				<td><%= link_to "Edit", edit_item_path(i.id), method: :get, :class => "button alert" %></td>
				<td><%= link_to "Delete", item_path(i.id), method: :delete, :class => "button danger" %></td>
			<% else %>
				<td>X</td>
				<td>X</td>
			<% end %>
	</tr>
	<% end %>
</table>


<script type="text/javascript">
buildMap(<%=raw @hash.to_json %>)
</script>
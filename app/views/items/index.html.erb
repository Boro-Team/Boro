
<% if @index_page %>


<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->
<script src='//cdn.rawgit.com/googlemaps/js-rich-marker/gh-pages/src/richmarker-compiled.js' type='text/javascript'></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>

	<div id="search_items" class="input-group input-group-lg row">
		<div > <!--class="input-group"-->
			<%= form_tag("/items", method: "get") do %>
			<%= text_field_tag(:term, params[:term], placeholder:"What are you looking for?" , style: "width: 300px", class: "form-control")%>

			<input id="geo" class="form-control" type="text" placeholder="Where are you looking?" size="90" />
			<%= hidden_field_tag(:formatted_address) %>
			<%= hidden_field_tag(:postal_code) %>
			<%= hidden_field_tag(:locality) %>
			<%= hidden_field_tag(:administrative_area_level_1) %>
			<%= hidden_field_tag(:country) %>
			<div> <!--class="input-group"-->
			
				<span id="basic-addon3" class="input-group-addon">Up to:</span> 
				<div class="input-group-btn">
				        <button  class="btn btn-default dropdown-toggle" ><%= select_tag("range", "<option>0</option><option>10</option><option>20</option><option>50</option><option>100</option>".html_safe)%></button>
				      </div><!-- /btn-group type="button"-->
				<span class="input-group-btn">
					<%= submit_tag("Search", class: 'btn btn-primary') %>
				</span>
			</div>
			<% end %>
			</div>
	</div>
<%= @error if @error %>

<div>
  <div id="search_map" style="overflow: hidden"></div>
</div>
<% end %>
<br>
<br>
<table>
	<tr>
		<th>Pic</th>
		<th>Title</th>
		<th>Category</th>
		<th>Description</th>
		<th>Price/Day</th>
		<th style="text-align: center;">Show</th>
		<th style="text-align: center;">Edit</th>
		<th style="text-align: center;">Delete</th>
	</tr>
		<% @item.each do |i| %>
	<tr>
		<td><%= image_tag (i.avatar.thumb.url) %></td>	
		<td><%= link_to "#{i.title}", item_path(i.id)  %></td>
		<td><%= link_to "#{i.tag_list.first}", tags_path(i.tag_list.first) %></td>
		<td style="text-align: center;">
			<%= truncate(i.description, length: 21) %>
		</td>
		<td style="text-align: center;"><%= i.price_per_day %></td>
		<td style="text-align: center;"><%= link_to "Show", item_path(i.id), method: :get, :class => "btn-lg btn-primary" %></td>

			<% if current_user.id == i.user_id %>
				<td style="text-align: center;"><%= link_to "Edit", edit_item_path(i.id), method: :get, :class => "btn-lg btn-warning" %></td>
				<td style="text-align: center;""><%= link_to "Delete", item_path(i.id), method: :delete, :class => "btn-lg btn-danger" %></td>
			<% else %>
				<td style="text-align: center;"><%= link_to "Book", new_item_rental_path(i.id), method: :get, :class => "btn-lg btn-success" %></td>
				<td style="text-align: center;""><%= link_to "Delete", item_path(i.id), method: :delete, :class => "btn-lg btn-danger" %></td>
	<% end %>
	</tr>
	<% end %>
</table> 

<%= @error if @error %>

<script type="text/javascript">
buildMap(<%=raw @hash.to_json %>)
</script>

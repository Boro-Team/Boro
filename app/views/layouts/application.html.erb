<!DOCTYPE html>
<html>
<head>
  <title>Boro</title>
  <%= stylesheet_link_tag 'foundation', media: 'all', 'data-turbolinks-track' => true %>
  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= stylesheet_link_tag 'https://cdnjs.cloudflare.com/ajax/libs/foundation-datepicker/1.5.3/css/foundation-datepicker.min.css' %>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <%= csrf_meta_tags %>
	<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
	<link rel="manifest" href="/manifest.json">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
	<%= favicon_link_tag "favicon.ico" %>
	<%= javascript_include_tag 'jquery', 'data-turbolinks-track' => true %>
	<%= javascript_include_tag 'foundation','data-turbolinks-track' => true %>
	<%= javascript_include_tag 'app', 'data-turbolinks-track' => true %>        
	<%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>    
	<%= javascript_include_tag 'jquery.geocomplete', 'data-turbolinks-track' => true %>
	<%= javascript_include_tag 'freewall', 'data-turbolinks-track' => true %>
	<%= javascript_include_tag 'https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js', 'data-turbolinks-track' => true %>
	<%= javascript_include_tag 'https://cdnjs.cloudflare.com/ajax/libs/foundation-datepicker/1.5.3/js/foundation-datepicker.min.js', 'data-turbolinks-track' => true %>
	<%= javascript_include_tag 'what-input','data-turbolinks-track' => true %>
	<meta name="apple-mobile-web-app-title" content="Boro">
	<meta name="application-name" content="Boro">
	<meta name="theme-color" content="#ffffff">
</head>

<body>

<!-- NOTICES & ALERTS -->

<!-- <p class="notice"><%= notice %></p>
<p class="alert"><%= alert %></p> -->


	<div class="anchor" data-sticky-container>
	<!-- <div class="callout alert">< %= display_flash_messages %></div> -->
	  <div class="top-bar sticky" data-sticky data-options="marginTop:0;" style="width:100%" data-top-anchor="2">
	    <div class="top-bar-left">     
	      <div>
	        <ul class="menu">
	          <li>
	            <a href="/">
	              <%=image_tag("boro_logo_64.png", alt: "Logo Image")%>
	            </a>
	          </li>         
	          <li>
	            <input type="search" placeholder="Where are you ?">
	          </li>
	          <li>
	            <button type="button" class="button">
	              Search
	            </button>
	          </li>
	        </ul>
	      </div>
	    </div>

	    <span><%= link_to "Items Index", items_path %></span>

	    <div class="title-bar-right">
	      <ul class="dropdown menu" data-dropdown-menu>
	        <li>
	       		<%= link_to "List your Item !", new_item_path %>
	          <ul class="menu">
	            <li>
	              <a href="/items/new">
	                List Your Item
	              </a>
	            </li>
	            <hr>     
	            <li>
	              <a href="#">
	                Dashboro
	              </a>
	            </li>
	            <hr>
	            <li>
	              <a href="#">
	                Your Reviews
	              </a>
	            </li>
	          </ul>
	        </li>

	        <li>
	          <a href="#">
	            Messages
	          </a>
	          <ul class="menu">
	            <li>
	              <a href="#">
	                Messages
	              </a>
	            </li>
	            <hr>
	            <li>
	              <a href="#">
	                Notifications
	              </a>
	            </li>
	          </ul>
	        </li>

	        <li>
	        <% if signed_in? %>   
	          <a href="#">
	            <%= current_user.first_name || current_user.id %>
	          </a>
	          <ul class="menu">
	            <li>
	              <%= link_to "Edit Profile", edit_user_registration_path(current_user) %>
	            </li>  
	            <li>
								<%= link_to "Account Settings", edit_user_registration_path(current_user) %>
	            </li>
	            <li>
	            	<%= button_to "Sign out", destroy_user_session_path, class: "button", method: :delete %>
	            </li>  
	        <% else %>
	          <a class="button medium success" data-open="registration">
	            Signup / Login
	          </a>
	        <% end %>
	          </ul>
	        <% if signed_in? %>
	          <% if current_user.avatar.present? %>
	          <li>
	            <a href="/users/<%= current_user.id %>" method="get">
	              <%= image_tag current_user.avatar.thumb.url, :id=> "avatar" %>  
	            </a>
	          </li>

	          <% else %>

	          <li>
	            <a href="/users/<%= current_user.id %>"" method="get">
	              <img id="avatar" src="http://placehold.it/64x64">
	            </a>
	          </li>      
	    
						<% end %>

	          <li>
	            <%= button_to "Sign out", destroy_user_session_path, class: "button", method: :delete %>
	          </li>    
	        <%end%>
	        </li>  
	      </ul> 
	    </li>
	  </div>
	</div>


<!-- This is a modal -->
<div class="reveal" id="registration" data-reveal>
  <h1 class="lead">Welcome to the Boro Community !</h1>
  <p>
    <%= link_to new_user_registration_path, class: "button", id: "register_email", action: :new, method: :get do %>
    <i class="fi-mail">Sign up with an email address</i>
    <% end %>
  </p>

  <p>
  	<%= link_to user_facebook_omniauth_callback_path, class: "button", id:"register_fb" do %>
    <i class="fi-social-facebook">Connect With Facebook</i>
    <% end %>
  </p>

  <span id="register_already" class="lead">
    I already have an account <%= link_to 'Log in', user_session_path, class: "button" %> 
  </span>
  
  <button class="close-button" data-close aria-label="Close reveal" type="button">
    <span aria-hidden="true">
      <a href="/">
        &times;
      </a>
    </span>
  </button>
</div>

<%= yield %>
<p><a href="/users/sign_up">Sign Up</a></p>

  <!-- GOOGLE MAPS STATIC -->

<script>
  function initMap() {
    var petaling = {lat: 3.134717, lng: 101.629968};  
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: petaling, 
      styles: [{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#46bcec"},{"visibility":"on"}]}]
    });
    var marker = new google.maps.Marker({
      position: petaling,
      map: map
    });
  }

// FREEWALL SCRIPT

// put Rails variable in JQuery ?
    var temp = "<div class='brick' style='width:{width}px;'><img src='/items/item{index}.jpg' width='100%'></div>";
    var w = 1, h = 1, html = '', limitItem = 29; // limitItem = Items.all.count in Ruby
    for (var i = 0; i < limitItem; ++i) {
      w = 1 + 3 * Math.random() << 0;
      html += temp.replace(/\{width\}/g, w*150).replace("{index}", i + 1);
    }
    $("#freewall").html(html);

    var wall = new Freewall("#freewall");
    wall.reset({
      selector: '.brick',
      animate: true,
      cellW: 150,
      cellH: 'auto',
      onResize: function() {
        wall.fitWidth();
      }
    });


    var images = wall.container.find('.brick');
    images.find('img').load(function() {
      wall.fitWidth();
    }); 


  //  GOOGLE MAPS TEST BEGIN 

      function initMap() {
        var petaling = {lat: 3.134717, lng: 101.629968};  
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: petaling
        });
        var marker = new google.maps.Marker({
          position: petaling,
          map: map
        });
      }
    </script>
 <!-- GOOGLE MAPS TEST END -->    
 <!-- GEOCOMPLETE START-->
  <script>
      $(function(){
        $("#geocomplete").geocomplete({
          map: ".map_canvas",
          details: "form",
          types: ["geocode", "establishment"],
          location: "Kuala Lumpur",
        });

        $("#find").click(function(){
          $("#geocomplete").trigger("geocode");
        });
      

        $(".brick").click(
      function(){
        $(this).fadeToggle(1000);
      });

      });
    </script>
 <!-- GEOCOMPLETE END -->

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB39iSJL86w7qssvZjO0-yd4gYm5c2gpa4&libraries=places&callback=initMap"></script>

</body>
</html>